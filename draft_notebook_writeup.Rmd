---
title: "Assessing reliability of an online behavioural laterality battery: a pre-registered study (draft notebook)"
output: html_notebook
---

## Authors
Adam J Parker, Zoe Woodhead, Paul Andrew Thompson, and Dorothy Bishop

We report here the results of analyses that were preregistered on Open Science Framework. The analyses here are based on the preregistration that was revised after piloting of the battery. On that basis, we made some modifications to the tasks and added a consonant-vowel Dichotic Listening task. We also adapted the analysis plan to include a structural equation modeling to look at dissociations between laterality on different tasks. The preregistration can be found <a href="https://osf.io/qe6b4"> here </a> .

## Introduction
Hemispheric specialisation (lateralisation) is a ubiquitous characteristic of the human brain, and yet many questions remain unanswered as to its causes and consequences. Much of the ambiguity in the literature may arise from unreliable measures of lateralisation and underpowered studies. This study aims to develop a reliable online battery to assess lateralisation, which could be used to test large numbers of participants.  

The new battery consists of four behavioural laterality tests, which will be described in more detail in the Methods section:   
1.	Rhyme Decision: A visual half-field task in which participants decide whether a central written word rhymes with the name of a laterally-presented picture. This measures laterality of language processing.  
2.	Dichotic Listening: A dichotic listening task in which participants hear two consonant-vowel (CV) auditory stimuli simultaneously, one to each ear. They are required to report which CV stimulus out of six options (ba, da, ga, ka, pa, ta) provided the best match to the stimulus they heard . This measures laterality of language processing.  
3.	Chimeric Faces: A visual half-field task in which participants view stimuli that are vertically split at the midline with each hemiface displaying one of four emotions (anger, disgust, happiness, and sadness), They are required to report the overall emotion that they perceive in the face. This measures laterality of face and emotion processing.  
4.	Finger Tapping: A speeded sequential key-pressing task performed using a computer keyboard with left and right hands. This provides a quantitative measure of relative skill of the two hands.    
In addition, participants completed online versions of:  

•	The Lexical Test for Advanced Learners of English (LexTALE; Lemhöfer & Broersma, 2012), to assess vocabulary as an indicator of language proficiency.  
•	The Edinburgh Handedness Inventory (Oldfield, 1971), to assess manual preference.  
•	Modified versions of the Miles Test (Miles, 1929) and the Porta Test (Porac & Coren, 1976) which are suitable for online testing, to assess ocular dominance.   
•	A basic demographic questionnaire. This included questions about age, gender, footedness, years in education, and bilingualism.   

The study was primarily exploratory. Our principal goal was to refine the four laterality tests to maximise test-retest reliability. The whole battery was administered at an initial testing session, then the four laterality tests were repeated at a second session 3-10 days later. In addition, we aimed to test some predictions about the relationships between laterality on the four tests.  

The primary outcome measure from each of the four tests is a laterality index; depending on the task, this is based on difference between left and right sides in accuracy (dichotic and chimeric faces tasks), reaction time (rhyme decision), or completed sequences (finger tapping) (see ‘Indices’ section below for details).  

As well as establishing reliability of measures, we consider the inter-relationships between them. With online testing, there is the opportunity to test this using an adequately powered sample using measures of known reliability.  Prior studies have been inconclusive because it has been difficult gather large amounts of data to establish test-retest reliability. For instance, Van der Haegen and Brysbaert (2018), found that language laterality did not correlate with face laterality in visual half-field tasks. However, their study was restricted to left-handers, who may be atypical in this regard, and they noted that lack of association was hard to interpret because it may be due to unreliability of measurement.  

Our research questions were as follows:  

1.	Is it possible to achieve test-retest reliability of .65 or more with laterality indices derived from the four laterality tests?  If so, could this be achieved more efficiently by using fewer trials in each test?  
2.	Laterality indices can be calculated in multiple different ways (e.g. using RT, accuracy or a combination of the two; as a raw difference score or a proportion). We will explore these options (described in more detail in the ‘Indices’ section) to determine which metric shows the strongest test-retest reliability.  
3.	Do extreme left-handers show a higher rate of atypical laterality than right-handers on the Rhyme Decision, Dichotic listening, or Chimeric Faces tasks?  
4.	Do the laterality indices from the language and faces laterality tasks correlate? We aimed to consider this questiron separately for left- and right-handers, since our previous research on language laterality indicated a single factor provided a good fit to data from right-handers but not left-handers.

## Hypotheses

As noted above, our main goal was to devise a battery of laterality assessments with adequate test-retest reliability. In addition we had specific a priori hypotheses relating to questions 3 and 4 as follows:

### Hypothesis 1
At a population level, the laterality indices for Rhyme Decision will show a right visual field advantage (indicating left hemisphere dominance for language processing); the laterality indices for the Dichotic Listening task will show a right ear advantage (indicating left hemisphere dominance for language); the laterality indices for Chimeric Faces will show a left visual field advantage (indicating right hemisphere dominance for face or emotion processing); and the Finger Tapping task will show a right hand advantage.

### Hypothesis 2
Strong left-handers (i.e. those with laterality quotient of -90 or less on the Edinburgh Handedness Inventory) will be more likely to show atypical laterality (i.e. laterality in the opposite direction to our population level predictions) than right-handers. This prediction follows from observations by Mazoyer et al (2014) who studied a large group of left- and right-handers using fMRI to measure language laterality. They concluded "concordance of hemispheric dominance for hand and for language occurs barely above the chance level, except in a group of rare individuals (less than 1% in the general population) who exhibit strong right hemisphere dominance for both language and their preferred hand."

### Hypothesis 3
For right-handers, a model (a) where the two language tasks are correlated with each other but not with the chimeric faces will provide better fit to the data than a model (b) in which laterality indices are correlated between the language and chimeric face tasks, or a base model (c) where each task is independently lateralised. For left-handers, we anticipate that that model (c) may be a better fit to the data, indicating that laterality is dissociated across the different tasks. 

## Design Plan
We note here specific study characteristics that are specified for a preregistration on OSF. We have added additional information to specify Methods in more detail.

### Study type
This is an observational Study in which data are collected from study subjects who are not randomly assigned to a treatment.   

### Blinding
No blinding is involved  

### Study design
We used a within-subjects design whereby participants performed each laterality task twice (repeated-measures) in order to establish test-retest reliability.  

The battery of tasks was broken into four blocks. Within each block, participants completed 70 trials of the Rhyme Detection task; 36 trials of the Dichotic Listening task; 32 trials of the Chimeric Face task; and 2 trials of the Finger Tapping task for both their dominant and non-dominant hand. Trial order for blocks of Rhyme Detection, Dichotic Listening, and Chimeric Face task was randomised. For the Finger Tapping task, all participants were asked to respond first with their dominant hand followed by their non-dominant hand. 

The order of tasks was balanced by using four possible orders as follows ABCD, BCDA, CDAB, DABC. Each successive participant entering the study was assigned the next task order in the sequence above. Order of tasks remained consistent across blocks for that participant.

### Randomization
No randomization was used in this study.

### Sampling Plan
The study was registered prior to collection of data

## Participants  
### Data collection procedures
We aimed to recruit participants via three methods:

1)	Given that we are also interested in genetically related samples, a portion of participants will be recruited via social media adverts, with encouragement for twins or first-degree relatives (siblings or parent-child pairs) to volunteer.  

2)	Undergraduate students from the University of Oxford will be recruited via the Department of Experimental Psychology’s Research Participation Scheme.  

3)	Other participants will be recruited from the Prolific web-based population (https://www.prolific.co/).  

In practice, the first route was ineffective, with very few related individuals volunteering. 
<!--Adam: can we report how many came from Prolific and how many from student scheme?-->

### Inclusion criteria
Participants were required to be at least 16 years old, native English speakers, with no reported history of neurological disease (e.g. head injury, brain tumour, stroke), no history of significant hearing loss/impairment, and with normal or corrected-to-normal vision. We intentionally oversampled left-handers (see below).

### Sample size
We specified we would continue data collection until we had complete and useable datasets from 300 participants. As explained below, we had fewer participants than this for one task, because of many exclusions. However, as this task performed poorly, we decided not to test further participants.

### Sample size rationale
As our ultimate goal is to use these measures in individual differences research, we aim to optimise the task to achieve observed test-retest reliability of at least .65. To achieve sufficient precision of the estimate of reliability, we estimated we needed 300 participants. With this sample size, if the true correlation is .58, then the 95% confidence interval around the estimate will be .499-.65.  Thus with this sample size, if we observe a correlation of .65, then the true correlation is unlikely to be lower than .58.

We aimed to collect data for approximately 80 left-handers and 220 right-handers. We examined the power that a sample of 80 participants would provide to make the model comparisons outlined under hypothesis 3. By comparing model fit using a likelihood test, 80 participants would provide 100% power for model (a) and 97% power for model (b). Thus, we would have sufficient power to assess the fit of each model using Akaike weights, which are more conservative than likelihood tests. 

### Stopping rule
We planned to cease data collection when we had collected 300 full datasets. 

## Methods  
### Manipulated variables
In this test-retest design, the within-subject independent variable of interest was Session (1 or 2).  
In the four laterality tasks, stimuli were presented in either the left or right visual fields (Rhyme Decision and Chimeric Faces), to the left or right ear (Dichotic Listening), or using the left or right hand (Finger Tapping).

### Tasks 
The test battery was implemented online via Gorilla (https://www.gorilla.sc/).
<!--Adam: could you add information about the checks for screensize-->

## Rhyme Decision
This was a novel visual-half-field task devised for this study. The goal was to devise a task that engaged phonological processing by requiring the participant to generate a name from a pictured object and judge if it rhymed with a centrally-presented written word. Two pictures were presented to the left and right of fixation, and the prediction was that judgements should be faster when the rhyming picture occurred in the right visual field, which projects directly to the left hemisphere. The stimulus trios (two pictures and a word) are shown in Appendix A. On xx trials, stimuli were presented for which there was no rhyme match; this was used as a means of identifying and excluding participants who were not attending carefully.

## Dichotic Listening 
Materials were taken from a dichotic listening task that has been developed as an app (Hugdahl et al., 2009). Participants wear stereo headphones. On each trial they hear two consonant-vowel (CV) auditory stimuli simultaneously, one to each ear. They are required to report which CV stimulus out of six options (ba, da, ga, ka, pa, ta) provided the best match to the stimulus they heard. This measures laterality of language processing. The original test has xx dichotic stimulus pair, xx of which present the same syllable in both ears. These latter stimuli could be used to identify individuals who had difficulty in discriminating the syllables. 
<!--Adam: could you add information about the checks for headphones-->

##	Chimeric Faces
Materials were taken from Chimeric Faces task developed by Burt & Perrett (1997) and used by Innes, Burt, Birch, & Hausmann (2016). Participants view stimuli that are vertically split at the midline with each hemiface displaying one of four emotions (anger, disgust, happiness, and sadness). They are required to report the overall emotion that they perceive in the face. This measures laterality of face and emotion processing.  The task also includes xx trials in which both sides of the face show the same emotion. This is used as a check to identify whether the participant can reliably identify the intended emotions when there is no conflicting information.

## Finger Tapping
This was a simple task devised for this study. Our goal was to see whether we could obtain a quantification of extent of relative motor skill of the two hands using the individual's computer keyboard. The participant was asked to use the index finger to tap a specified sequence of keys continuously for a 20 second <!--Adam: is that right?--> interval, and the number of correct sequences was counted. The task was performed first with the preferred hand and then with the nonpreferred hand.  

## Other tasks  
The Lexical Test for Advanced Learners of English (LexTALE; Lemhöfer & Broersma, 2012) was used to assess vocabulary as an indicator of language proficiency.
The Edinburgh Handedness Inventory (Oldfield, 1971) was used to assess manual preference.  
Modified versions of the Miles Test (Miles, 1929) and the Porta Test (Porac & Coren, 1976) were used to assess ocular dominance, and a question about foot preference.
<!--Adam Could you give more information about Lextale, Miles/Porta, and what was the foot preference question-->


## Measured variables  
For Rhyme Detection, Dichotic Listening, and Chimeric Faces, the measured variables were reaction time (RT) and accuracy. These were converted into laterality indices, as described below. For the Finger Tapping task, the measured variable was correct number of sequences produced with the right and left hands. This was also be converted into a laterality index.

For the LexTALE task, the measured variables was the number of words with correct responses (out of 40) and the number of nonwords with correct responses (out of 20). An adjusted score was computed by averaging the percentage of correct words and the percentage of correct nonwords (e.g., ((number of words correct/40*100) + (number of nonwords correct/20*100)) / 2).

The Edinburgh Handedness Inventory was scored in the standard way, which involves combining information about direction and exclusiveness of hand preference across ten tasks. For simple contrast between left- and right-handers, we treated indices greater than 0 as right handed, and indices less than 0 as left handed. For analysis of extreme left-handers, we focussed on left-handers with an index of -90 or less, which corresponds to near-exclusive use of the left hand. 

Adapted versions of the Miles Test and Porta Test will classify participants as being either left or right eye dominant.<!---Adam: not sure if we need this here, as we did not specify how they would be used in analysis?--->

## Laterality Indices
The classic way of calculating a laterality index is to take the difference between left and right sides and divide it between the total for the two sides. This gives a difference measure that is scaled by the individual's overall speed or accuracy.  

We also experimented with an alternative approach that allows one to identify whether an individual participant is reliably lateralised. For Reaction Time measures, this involved taking all the RTs for left and right-sided responses in a single participant, and conducting a t-test. One can then set a cutoff for reliable lateralisation, e.g. by using a t-value of 1.96, which would occur in around 5% of individuals if there was no real bias to one side. Based on considerations from pilot data, we planned to transform RT data from the RDT task by  log-transformation before computing t-values. 

Similar logic can be used for accuracy measures, where a z-score can be computed and interpreted in relation to the normal distribution, using the formula:
z = (pR-.5)/sqrt(pR*pL/n) 
where pR is the proportion of R responses, pL is proportion of L responses, and n is total L and R responses. 

These t- and z-measures amount to rescaling of the conventional laterality quotient and so are not expected to give different values for reliability, but they may be useful if one wanted to distinguish between individuals who showed robust lateralisation versus those who showed less convincing bias to one side.



### Data exclusion

In the laterality tasks, individual trials will be excluded from analysis if the reaction time was faster than 200 ms, as this suggests an anticipatory response. We did not preregister an upper RT boundary, but planned to apply Hoaglin-Iglewicz criteria (Hoaglin & Iglewicz 1987) to minimise the influence of outliers in the rightwards tail of the distribution. As such, outliers are defined as RTs that are 1.65 times the difference between the first and third quantiles (1.65*(Q3-Q1)) below or above the first and third quantile values. Our cut-off criterion was set to 1.65 instead of the typical 2.2. This is because we expected to obtain asymmetric distributions for reaction time, since reaction time is always non-negative, and so most outliers would be in one tail of the distribution.

Participants will be excluded if:
•	Responses were excluded or missing for more than 20% of trials in any condition in either of the language laterality tasks or chimeric faces.  
•	Performance for stimuli presented in their dominant visual-half field is not significantly above chance level. Moreover, participants whose performance for stimuli presented in their non-dominant visual half field is significantly below chance will also be excluded.   
•	LexTALE adjusted score is below 80, indicating that a participant’s level of vocabulary knowledge is below the cut off for lower advanced proficiency. We anticipate that native English speakers will have high proficiency and therefore will score highly on this task.  
•	For the Chimeric Face Task, participants’ data will be excluded if their accuracy on trials with identical emotions in each hemiface is below 75%. This is to ensure that participants can sufficiently judge emotion expression.  
•	For the Dichotic Listening task, participants’ data will be excluded if their accuracy on trials with identical sounds played to each ear is below 75%.  
•	In the dichotic listening task we will screen for headphone use using an adapted version of a task reported by Woods, Siegle, Traer, and McDermott (2017) where participants judge which of three tones is the softest. If accuracy is lower than 5 out of 6, we will remove participants as recommended by Woods et al.   

### Missing data

Excluded participants will be replaced, so that a total of 300 complete datasets are collected.  


## Data Analysis
### Statistical models

For the reliability assessment, we plotted the distributions of laterality indices and checked them for normality using the Shapiro-Wilk test. For normally-distributed scores, we used Pearson correlation coefficients for time 1 vs time 2, after excluding outliers. In the pre-registration we suggestd we might transform data to achieve normality if necessary, or alternatively use a Spearman correlation.

Optimising the test battery: If reliability turns out to be very high (above .75) with the existing test length, we will reanalyse the data using just the first N trials, reducing N until reliability becomes unsatisfactory (below r=0.65). This will allow us to identify the most efficient way to administer these tasks in future, while retaining good reliability. However, the full data (including all trials) will be used for all subsequent analyses.
<!---Adam: we have not done this yet, but it should not be too hard--->

To test Hypothesis 1 (laterality bias at a population level) one-sample t-tests will be applied for each task and session.

Hypothesis 2 predicts that left-handers will be more likely to show atypical laterality than right-handers. The test of this hypothesis will be complicated by having to decide how to define 'atypical'. Ideally, these would be individuals who have significant lateralisation in the opposite direction to the majority, as indicated by p < .05 on the individual z-score or t-score. We anticipated, however, that this criterion may select very few cases on some of our tasks, in which case we will adjust the cutoff on that task until we have at least 20 atypical cases. Once typicality is defined, we will first analyse atypicality on the Rhyme Decision and Chimeric Faces task. Participants will be categorised into four groups: typical on both; atypical on Rhyme Decision only; atypical on Chimeric Faces only, and atypical on both. A chi square test will be used to test for association with the number of people in each of the four groups and the handedness classification from the Edinburgh Handedness Inventory. This will then be repeated for the Dichotic Listening and the Chimeric Faces tasks. <!---to do--->

Hypothesis 3 concerns the relationships between the laterality measures. We planned to use  structural equation modelling (SEM) to compare the covariances of the laterality statistics between the two language tasks and chimeric faces to test between three models. This would be done separately for left- and right-handers. Before doing this we would flip the polarity of chimeric faces, so that all predictions are for positive correlations.

There were no specific predictions for the finger tapping task; this was included as an exploratory measure, which may allow us to better characterise handedness on a dimension.

## Inference criteria

Assessment of test-retest reliability will use the 95% confidence interval around the estimate, as documented above.  
Assessment of whether a function is lateralised will be tested for a difference from zero using a conventional .05 significance level.
The association between handedness and atypical laterality will be tested using a Bonferroni corrected .025 significance level.
Model fit will be evaluated using AIC model selection using Akaike weights (Wagenmakers & Farrell, 2004). Akaike weights are transformations of the AIC values, which can be directly interpreted as conditional probabilities for each model. The best fitting model to the data for right- and left-handers will be selected as the final model.


## Exploratory analysis

As noted above, we will use the z- or t-statistics to index laterality, but we will have a large dataset that might be used subsequently to explore different approaches to measuring a laterality index, and to consider how choice of measure affects test-retest reliability.  

While the role of the LexTALE in the current research is largely for the purpose of data exclusion, we plan to explore correlations between LexTALE score and the laterality index on the Rhyme Decision task. This will enable us to examine whether vocabulary knowledge is related to rhyme judgement when information is displayed in each hemifield. We will similarly explore the influence of sight dominance, handedness/footedness, and the Finger Tapping Task on the laterality index for rhyme decision.  

Finally, we will investigate whether the method for measuring handedness has an impact on the associations between handedness and laterality on the Rhyme Decision and Chimeric Faces tests. In our main planned analyses, handedness will be coded using a binary categorisation of the Edinburgh Handedness Inventory scores, where > 0 indicates right handedness and < 0 indicates left handedness. There are many alternative ways of coding handedness: e.g. using three categories (right handed, ambidextrous and left handed); as a continuous measure; using self-report handedness; or using performance on the Finger Tapping test as an objective, continuous measure. We will explore which of these coding systems gives the strongest associations with laterality indices on the Rhyme Decision and Chimeric Faces. To do this we will select half the data at random to explore associations, and then aim to replicate on the second half.  

## Results


```{r setup, echo=FALSE,include=TRUE}
knitr::opts_chunk$set(echo = TRUE)
require(tidyverse)
library(MASS)
library(lavaan)
library(qpcR) #?? why do we need this?!
library(tidyverse)
library(semPlot)
library(RVAideMemoire) #for spearman.ci
library(ggplot2)
library(kableExtra)
library(corrr)
options(knitr.kable.NA = '') #should suppress NA in tables

```
<!---Notes to Adam from Dorothy (7th June 2020).
I've deposited the LIs file on OSF and now am reading direct from that.
I want to double check polarity of LIs - not sure they are all consistently in same direction.  
I turned the basic plotting/correlation etc into a function so it can be applied to all tasks.  
I added a vertical line to density plots at zero.
Have added a new column handed3 which distinguishes between extreme left handers and others. This may need tweaking in terms of the colours used to code and the terms,
Added a one-sample t-test to check if significantly lateralised - but then found you had done that later!
No longer removing those without complete datasets
I will try to condense results so they can be reported more succinctly--->

```{r read_dat,echo=FALSE,include=TRUE}
# read in data from csv
LIs <- read.csv('https://osf.io/x5jd2/download',stringsAsFactors = F)
#LIs <- read.csv("LIs.csv", na.strings = c("NA", ""))
# then we exclude those who we do not have full datasets for 
# This step currently omitted: use all available data for each task
# LIs <- subset(LIs, exclude== 0)

#Add a category of handedness that distinguishes extreme left from other left-handers
#In preregistration, extreme left defined as EHI laterality -90 or less.
LIs$handed3 <- LIs$handedness
w<-which(LIs$index_EHI<(-89))
LIs$handed3[w]<-'Extreme.left'

```

```{r make.combotable,echo=FALSE,include=TRUE}
#Make a table to summarise results for all 4 tasks
#This will gradually get populated as we go through each task

#Cells for each task are filled in course of plots.function chunk

combotable <- data.frame(matrix(NA,nrow=7,ncol=9))
colnames(combotable)<-c('.','RhymeRT1','RhymeRT2','DichoticAcc1','DichoticAcc2','ChimericAcc1','ChimericAcc2','FingerAcc1','FingerAcc2')
combotable[,1]<-c('N','mean','SD','p-lateralised','p-normal','test-retest r','CI r')
```

```{r plots.function, echo=FALSE,include=TRUE}
# Adam's code here turned into generic function
# While we have the relevant columns specified here, I have added steps to populate combotable as we go.
# Also saving the scatterplots as png
densplots <- function(t1,t2,name1,name2,scattername,combotable,combocolumn){
  dens1<-ggplot(LIs, aes(x=t1))+geom_density(linetype="dashed")+theme_classic()+ggtitle(name1)
  dens1 <- dens1+ geom_vline(xintercept = 0)
# normality
shap1<-shapiro.test(t1)
ttest1 <- t.test(t1) #Check if significantly lateralised
Nt1 <- length(t1)-length(which(is.na(t1)))
combotable[1,combocolumn]<-Nt1
combotable[2,combocolumn]<-round(mean(t1,na.rm=T),2)
combotable[3,combocolumn]<-round(sd(t1,na.rm=T),2)
combotable[4,combocolumn]<-round(ttest1$p.value,3)
combotable[5,combocolumn]<-round(shap1$p.value,3)

# day 2
# plot denisty
dens2<-ggplot(LIs, aes(x=t2))+geom_density(linetype="dashed")+theme_classic()+ggtitle(name2)
dens2 <- dens2+ geom_vline(xintercept = 0)
# normality
shap2<-shapiro.test(t2)
ttest2 <- t.test(t2)
Nt2 <- length(t2)-length(which(is.na(t2)))
myN<-min(Nt1,Nt2)
combotable[2,(combocolumn+1)]<-round(mean(t2,na.rm=T),2)
combotable[3,(combocolumn+1)]<-round(sd(t2,na.rm=T),2)
combotable[4,(combocolumn+1)]<-round(ttest2$p.value,3)
combotable[5,(combocolumn+1)]<-round(shap2$p.value,3)
# conduct Spearman's wth bootstrapped CI
myspear<-spearman.ci(t1, t2, nrep = 10000, conf.level = 0.95)

combotable[6,combocolumn]<-round(myspear$estimate,2)
myci <- paste0(round(myspear$conf.int[1],2),' - ',round(myspear$conf.int[2],2))
combotable[7,combocolumn]<-myci
# scatterplot time1 x time2
# position for label set to 50%x and 90%y
xpos <- max(t1,na.rm=T)*.5
ypos <- max(t2,na.rm=T)*.9

mycor<-cor.test(t1, t2, method = "spearman", alternative = "greater")$estimate

#Make a label to show the correlation with 95%CI and N on the plot
mycorlabel<-paste0('r = ',round(mycor,2),'\n(95% CI: ',round(myspear$conf.int[1],2),'-',round(myspear$conf.int[2],2),')\nN = ',myN)
#Find position in top L corner for legend
legposx <- .2 #not working - needs tweaking!
legposy <- .85
myscatter <- ggplot(LIs, aes(x= t1, y= t2)) +
  geom_hline(yintercept=0, color = "black") +
  geom_vline(xintercept=0, color = "black") +
  geom_point(aes(color= handed3)) + 
  geom_rug(aes(color= handed3)) +
  theme_classic() +
  ylab(name2) + 
  xlab(name1) +
  annotate("text", x = xpos, y = ypos, label = mycorlabel) +
  theme(legend.position = c(legposx,legposy))
# Set relative size of marginal plots (main plot 10x bigger than marginals)
bigplot<-ggExtra::ggMarginal(myscatter, groupColour = TRUE, groupFill = TRUE)
scattername<-paste0(scattername,".png")
ggsave(scattername,plot=bigplot,dpi = 300)

return(combotable)
}
```
<!--- We start by completing combotable for the 4 main measures. NB need to check polarity of tasks - also oddity re RDT distributions needs checking, and we said we'd do log transform , not sure we did--->
```{r doplots.RDT_RT,echo=FALSE,include=TRUE}
t1<-LIs$Day1.RDT_RT_LI
t2<-LIs$Day2.RDT_RT_LI
name1<-"Rhyme decision LI (day 1)"
name2<-"Rhyme decision LI (day 2)"
scattername<-"RhymeDecisionScatter"
combocolumn<-2 #column to write day 1 summary for this task in combotable
combotable<-densplots(t1,t2,name1,name2,scattername, combotable,combocolumn)

```


```{r doplots.dichotic_Accscore,echo=FALSE,include=TRUE}
t1<-LIs$Day1_DL_acc_LI
t2<-LIs$Day2_DL_acc_LI
name1<-"Dichotic LI acc (day 1)"
name2<-"Dichotic LI acc (day 2)"
scattername<-"DichoticScatter"
combocolumn<-4 #column to write day 1 summary for this task in combotable
combotable<-densplots(t1,t2,name1,name2,scattername, combotable,combocolumn)

```

```{r doplots.chimeric_Acc,echo=FALSE,include=TRUE}
t1<-LIs$Day1_CF_acc_LI
t2<-LIs$Day2_CF_acc_LI
name1<-"Chimeric LI acc (day 1)"
name2<-"Chimeric LI acc (day 2)"
scattername<-"ChimericScatter"
combocolumn<-6 #column to write day 1 summary for this task in combotable
combotable<-densplots(t1,t2,name1,name2,scattername, combotable,combocolumn)

```

```{r doplots.fingerLI,echo=FALSE,include=TRUE}
t1<-LIs$Day1_finger_LI
t2<-LIs$Day2_finger_LI
name1<-"Finger LI (day 1)"
name2<-"Finger LI (day 2)"
scattername<-"FingerScatter"
combocolumn<-8 #column to write day 1 summary for this task in combotable
combotable<-densplots(t1,t2,name1,name2,scattername, combotable,combocolumn)

```
### Table 1

```{r Table1,echo=FALSE}
#Needs more formatting. For word output may need to use flextable. See https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html
combotable%>%
  kable() %>%
  kable_styling("condensed")


```
### Question 1
We first consider question 1: Is it possible to achieve test-retest reliability of .65 or more with laterality indices derived from the four laterality tests?  If so, could this be achieved more efficiently by using fewer trials in each test?  

Table 1 shows results for the Laterality Indices (LIs) for the four tasks at time 1 and time 2 in terms of significance of lateralisation ('p-lateralised', i.e. comparison with distribution with mean of zero), significance of departure from normality on Shapiro-Wilks test ('p-normal'), plus the Spearman correlation between time 1 and time 2 (test-retest reliability).

Figures 1-4 show the scatterplots for time 1 and time 2 LIs for all four tasks, with left-handers colour-coded, and extreme left-handers marked in black.

![Figure 1](RhymeDecisionScatter.png)

![Figure 2](DichoticScatter.png)
![Figure 3](ChimericScatter.png)
![Figure 4](FingerScatter.png)

These analyses show good reliability for Dichotic Listening, Chimeric Faces and Finger Tapping. These tasks are also significantly lateralised in the predicted direction.  The Rhyme Detection Task is unsatisfactory: the test-retest correlation is below our specified cutoff r= .65 for both RT and accuracy (not shown here). For RT, there is significant lateralisation, but in absolute terms it is small, with a high proportion LVF-lateralised.  <!---Adam: you mentioned laterality was opposite to prediction - I think it is in the right direction, but we need to check: for RT a big score means slower performance and I am not sure if I adjusted adequately for that. Need anyhow to do with log RTs since that is what we preregistered - I don't think it will make much difference--->

Note also that we fell short of 300 participants for this task. This is because many participants were dropped because they did not meet our inclusion criteria - e.g. low accuracy.  
We had previously modified this task in an attempt to improve its reliability, but these analyses question whether it is useful, so we decided not to test further participants. 

*Still to be done: consider reliabilities with fewer trials. How short a test is feasible without loss of reliability?*

### Question 2
Laterality indices can be calculated in multiple different ways (e.g. using RT, accuracy or a combination of the two; as a raw difference score or a proportion). We will explore these options (described in more detail in the ‘Indices’ section) to determine which metric shows the strongest test-retest reliability. 

*Still to be done - we have computed the z-score and t-test versions discussed in introduction *

### Question 3
Do extreme left-handers show a higher rate of atypical laterality than right-handers on the Rhyme Decision, Dichotic listening, or Chimeric Faces tasks?

For our preliminary analysis, we define 'atypical laterality' as laterality that is in the opposite direction to the majority, and which has an absolute z-score or t-score value greater than 1.96. These z and t-scores indicate whether there is significant bias to the left or right within an individual.  

According to the pre-registration, we omit non-extreme left-handers, but we show their data here for completeness. We also specified in the preregistration that we would analyse performance for pairs of tasks, but the very weak lateralisation of the Rhyme Decision task made that a questionable analysis. Tables 2 to 4 show associations between handedness categories and laterality classification for individual tasks first. We did not specify how we would handle data from the two sessions: these provide an opportunity for exploratory analyses from session 1 to then be confirmed using session 2 data, so for each task we start just with session 1.



```{r makecontingencies,echo=FALSE}
#We start by using z-scores to make a 3-way categorisation into:
#1 sig bias in typical direction; 2: NS bias 3: in atypical direction with sig bias.
#
LIs$rhyme1.cut <- cut(LIs$Day1.RDT_p.corr_LI, 
                       breaks = c(-Inf, -1.96, 1.96, Inf), 
                       labels = c("TypLat", "Nonlat", "AtypLat"), 
                       right = FALSE)
LIs$dichotic1.cut <- cut(LIs$Day1_Dich_acc_Z, 
                       breaks = c(-Inf, -1.96, 1.96, Inf), 
                       labels = c("TypLat", "Nonlat", "AtypLat"), 
                       right = FALSE)
LIs$chimeric1.cut <- cut(LIs$Day1_CF_acc_Z, 
                       breaks =  c(-Inf, -1.96, 1.96, Inf), 
                       labels = c("AtypLat", "Nonlat", "TypLat"), 
                       right = FALSE)
mytabr <- table(LIs$rhyme1.cut)
mytabd <- table(LIs$dichotic1.cut)
mytabc <- table(LIs$chimeric1.cut)
mytabc<-mytabc[c(3,2,1)]
mytab2 <-rbind(mytabr,mytabd,mytabc)
row.names(mytab2)<-c('Rhyme decision','Dichotic','Chimeric Faces')
mytab2<-data.frame(mytab2)

mytab2%>%
  kable() %>%
  kable_styling("condensed")

tabr <- table(LIs$handed3,LIs$rhyme1.cut)
chisq.test(tabr)

tabd <- table(LIs$handed3,LIs$dichotic1.cut)
chisq.test(tabd)

tabc <- table(LIs$handed3,LIs$chimeric1.cut)
chisq.test(tabc)

#Planned test omitted group 'Left' and column Nonlat.
chi.r<-chisq.test(tabr[c(1,3),c(1,3)])

chi.d<-chisq.test(tabd[c(1,3),c(1,3)])
chi.c<-chisq.test(tabc[c(1,3),c(1,3)])
```

Table 2: Rhyme judgement
```{r showtabr,echo=FALSE}
tabr%>%
  kable() %>%
  kable_styling("condensed")
```
Table 3: Dichotic listening
```{r showtabd}
tabd%>%
  kable() %>%
  kable_styling("condensed")

```


Table 4: Chimeric faces
```{r showtabc,echo=FALSE}
tabc%>%
  kable() %>%
  kable_styling("condensed")

```
It is evident that the Rhyme Judgement task has few individuals who are significantly lateralised in either direction. We will therefore not consider it further, as our analyses are only justified if the task is an indicator of cerebral lateralisation. Both Dichotic Listening and Chimeric Faces, on the other hand, are strongly lateralised.  The planned analyses, just comparing typically lateralised with atypically lateralised individuals, and extreme left vs right-handed individuals, show significant association between extreme left-handedness and atypical laterality on chi square test. For dichotic listening, chi squared = `r round(chi.d$statistic,2)`, d.f. = 1, p = `r round(chi.d$p.value,3)`; for chimeric faces, chi squared = `r round(chi.c$statistic,2)`, d.f. = 1, p = `r round(chi.c$p.value,3)`.  

With all participants included, on the dichotic listening task, `r round(100*tabd[1,3]/sum(tabd[,3]),1)`% of those with atypical laterality were extreme left-handers, `r round(100*tabd[3,3]/sum(tabd[,3]),1)`% were right-handers, and the remainder less extreme left-handers. For those with typical lateralisation, the corresponding figures were `r round(100*tabd[1,1]/sum(tabd[,1]),1)`% extreme left-handers, `r round(100*tabd[3,1]/sum(tabd[,1]),1)`% right-handers, and the remainder less extreme left-handers.

<!-- NB v confusing because the table gives the Atypical/Typical in different order for the chimeric faces-->
For chimeric faces, the association was even more extreme.  `r round(100*tabc[1,1]/sum(tabc[,1]),1)`% of those with Atypical laterality were extreme left-handers, `r round(100*tabc[3,1]/sum(tabc[,1]),1)`% were right-handers, and the remainder less extreme left-handers. For those with typical lateralisation, `r round(100*tabc[1,3]/sum(tabc[,3]),1)`% were extreme left-handers, `r round(100*tabc[3,3]/sum(tabc[,3]),1)`% were right-handers, and the remainder less extreme left-handers.  

```{r contingency2tasks,echo=FALSE,include=TRUE}
tab2task <- table(LIs$dichotic1.cut,LIs$chimeric1.cut)
chi2task<-chisq.test(tab2task)
w1<-which(LIs$chimeric1.cut=='AtypLat')
w2<-which(LIs$dichotic1.cut=='AtypLat')
w3<-intersect(w1,w2)
LIs$handed3[w3]
```

The planned analysis looking at cases who were atypical on both dichotic listening and chimeric faces was hampered by the fact that the two tasks were not associated (see below), and consequently there were only four cases in this category. Nevertheless, it was noteworthy that two of these were extreme left-handers and the other two were less extreme left-handers.

This brings us to the final set of predictions regarding associations between tests.

## Question 4
Our final question was whether the laterality indices from the language and faces laterality tasks correlate? Specifically we had predicted that in right-handers the two language tasks would correlate together, but the chimeric faces would form a separate factor, but in left-handers, the language tasks might fractionate.

This analysis was handicapped by the fact that one of the language indices, the rhyme judgement task, lacked both reliability and validity. Therefore we present the planned analysis in supplementary material, just for completeness. Here we consider the intercorrelations between the reliable tasks, including finger tapping instead of rhyme judgement. This is motivated by the prior observations that on both dichotic listening and chimeric faces, there was some association between handedness and lateralised task performance.

We had planned to use a structural equation modelling framework to compare the covariances of the laterality statistics between the two language tasks and chimeric faces to test between three models, separately for left- and right-handers. However, in neither handedness group were there any meaningful correlations between laterality indices.


```{r prep_dat,echo=FALSE}
# now create subset of data frame for analysis
mycols <- c('Day1.RDT_RT_LI', 'Day2.RDT_RT_LI',
            'Day1_CF_acc_LI', 'Day2_CF_acc_LI',
            'Day1_DL_acc_LI', 'Day2_DL_acc_LI',
            'Day1_finger_LI', 'Day2_finger_LI',
            'handedness')
colnums<- which(colnames(LIs) %in% mycols)
M <- LIs[,colnums]
M <- M %>% 
  rename(
    "rhyme1" = Day1.RDT_RT_LI,
    "rhyme2" = Day2.RDT_RT_LI,
    "chimeric1" = Day1_CF_acc_LI,
    "chimeric2" = Day2_CF_acc_LI,
    "dichotic1" = Day1_DL_acc_LI,
    "dichotic2" = Day2_DL_acc_LI,
    "finger1" = Day1_finger_LI,
    "finger2" = Day2_finger_LI)
# subset into right and left handers
left_dat <- subset(M, handedness== "Left")
right_dat <- subset(M, handedness== "Right")
```

```{r showcorrs,echo=FALSE}
#Will focus just on Day1
#Had considered showing as correlation heatmap - but values so small it wouldn't be worth doing!

#http://www.sthda.com/english/wiki/ggplot2-quick-correlation-matrix-heatmap-r-software-and-data-visualization

corrL<-round(cor(left_dat[,c(2,4,6,8)],use='complete.obs'),2)
corrR<-round(cor(right_dat[,c(2,4,6,8)],use='complete.obs'),2)


```

### Table 5: Intratask correlations for Left handers
```{r dotab5,echo=FALSE}
corrL%>%
  kable() %>%
  kable_styling("condensed")
```

### Table 6: Intratask correlations for Right handers
```{r dotab6,echo=FALSE}
corrR%>%
  kable() %>%
  kable_styling("condensed")
```
<!---I have run out of steam at this point. I think some of the correlations in *left-handers* might be statistically significant, though very small. But the only ones that look at all nonzero are with rhyme! Will just redo for time 2 to see if this is robust-->

```{r corrtime2,echo=FALSE,include=TRUE}
corrL2<-round(cor(left_dat[,c(3,5,7,9)],use='complete.obs'),2)
corrR2<-round(cor(right_dat[,c(3,5,7,9)],use='complete.obs'),2)

```

The correlations between tasks are all very low. To check if this pattern is robust, this analysis was repeated for time 2 data.

### Table 7: Intratask correlations time 2, for Left handers
```{r dotab7,echo=FALSE}
corrL2%>%
  kable() %>%
  kable_styling("condensed")
```

### Table 8: Intratask correlations time 2 ,for Right handers
```{r dotab8,echo=FALSE}
corrR2%>%
  kable() %>%
  kable_styling("condensed")
```

## SEM model 

Here we model left hander data with three prespecified covariance structures, then compare using AIC weights.

This is a subset of SEM that dos not include any latent variables or directional paths. It only looks to constrain particular covariance patterns and report 'best' model according AIC weights.

```{r Roger_mod_left,echo=FALSE}
model1<-"
dichotic1~~0*rhyme1
dichotic1~~0*chimeric1 
rhyme1~~0*chimeric1 
"

model2<-"
dichotic1~~rhyme1 
dichotic1~~0*chimeric1
rhyme1~~0*chimeric1 
"

model3<-"
dichotic1~~rhyme1 
dichotic1~~chimeric1 
rhyme1~~chimeric1
"

fit1A <- cfa(model1, data=left_dat)
fit2A <- cfa(model2, data=left_dat)
fit3A <- cfa(model3, data=left_dat)

aic_vector1 <- c(fitMeasures(fit1A, "aic"),fitMeasures(fit2A, "aic"),fitMeasures(fit3A, "aic"))

summary(fit1A, fit.measures=TRUE)
summary(fit2A, fit.measures=TRUE)
summary(fit3A, fit.measures=TRUE)

AICweights1<-akaike.weights(aic_vector1)$weights

IC_objectweights1<-data.frame(Model=factor(rep(c('Model 1','Model 2','Model 3'))), IC = factor(rep('AIC',each=3)),values=AICweights1)

ggplot(IC_objectweights1,aes(Model,values,fill=Model))+
  geom_bar(stat='identity',position="dodge")+
  ylab('Akaike weights') + theme_classic()
```



```{r Roger_mod_right,echo=FALSE}
#We now repeat this for right handers. 
fit1B <- cfa(model1, data=right_dat)
fit2B <- cfa(model2, data=right_dat)
fit3B <- cfa(model3, data=right_dat)

aic_vector2 <- c(fitMeasures(fit1B, "aic"),fitMeasures(fit2B, "aic"),fitMeasures(fit3B, "aic"))

summary(fit1B, fit.measures=TRUE)
summary(fit2B, fit.measures=TRUE)
summary(fit3B, fit.measures=TRUE)

AICweights2<-akaike.weights(aic_vector2)$weights

IC_objectweights2<-data.frame(Model=factor(rep(c('Model 1','Model 2','Model 3'))), IC = factor(rep('AIC',each=3)),values=AICweights2)

ggplot(IC_objectweights2,aes(Model,values,fill=Model)) +
  geom_bar(stat='identity',position="dodge")+
  ylab('Akaike weights') + theme_classic()
```

## Other analyses
<!---Original text: Upon an initial look, there is a reasonable correlation between the EHI and day 1 on the finger tapping. However, it does look like there are two clusters. So, we take a look at the left and right handers seperately. Doing so yields dissappointing results.-->
<!---DB: Not sure I understood this - is the point that strength of handedness on EHI is not related to finger tapping within handedness groups? --->


```{r H1,echo=FALSE,include=TRUE }
# Nice plots of distributions for each LI but I don't think we need these if we have the scatterplots, as they show the same information. T-tests done above.
#I've preserved the script as we may want to use it, but put it in a loop so it is optional for now.
doH1 <-0
if(doH1 ==1){
mycols <- c('Day1.RDT_RT_LI','Day1_DL_acc_LI','Day1_CF_acc_LI',  'Day1_finger_LI', "handedness")
colnums<- which(colnames(LIs) %in% mycols)
M <- LIs[,colnums]
N <- M %>% 
  rename(
    "CF" = Day1_CF_acc_LI,
    "DL" = Day1_DL_acc_LI,
    "RD" = Day1.RDT_RT_LI,
    "FT" = Day1_finger_LI)
# PLOT TO SEE IF DIFFERENT FROM ZERO
N$ID <- 1:nrow(N)
# format to long
data_long <- tidyr::gather(N, task, index, `CF`:`FT`, factor_key=TRUE)
# plot data
a <- ggplot(subset(data_long, task== "RD"), aes(x = task, y = index)) +
  geom_hline(yintercept=0, linetype="dashed", color = "red") +
  ggpirate::geom_pirate(aes(colour = "black"), bars = FALSE, 
                        points_params = list(shape = 19, alpha = 0.5), lines_params = list(size = 0.8)) +
  ylab("Laterality Index") + xlab("") + ylim(-30, 30) +
  scale_colour_manual(values = "darkgray") + theme_classic() 
b <- ggplot(subset(data_long, task== "DL"), aes(x = task, y = index)) +
  geom_hline(yintercept=0, linetype="dashed", color = "red") +
  ggpirate::geom_pirate(aes(colour = "black"), bars = FALSE, 
                        points_params = list(shape = 19, alpha = 0.5), lines_params = list(size = 0.8)) +
  ylab("Laterality Index") + xlab("") + ylim(-100, 100) +
  scale_colour_manual(values = "darkgray") + theme_classic() 
c <- ggplot(subset(data_long, task== "CF"), aes(x = task, y = index)) +
  geom_hline(yintercept=0, linetype="dashed", color = "red") +
  ggpirate::geom_pirate(aes(colour = "black"), bars = FALSE, 
                        points_params = list(shape = 19, alpha = 0.5), lines_params = list(size = 0.8)) +
  ylab("Laterality Index") + xlab("") + ylim(-100, 100) +
  scale_colour_manual(values = "darkgray") + theme_classic() 
d <- ggplot(subset(data_long, task== "FT"), aes(x = task, y = index)) +
  geom_hline(yintercept=0, linetype="dashed", color = "red") +
  ggpirate::geom_pirate(aes(colour = "black"), bars = FALSE, 
                        points_params = list(shape = 19, alpha = 0.5), lines_params = list(size = 0.8)) +
  ylab("Laterality Index") + xlab("") + ylim(-30, 30) +
  scale_colour_manual(values = "darkgray") + theme_classic() 
ggpubr::ggarrange(a, b, c, d)
t.test(LIs$Day1_CF_acc_LI, mu= 0)
t.test(LIs$Day1_DL_acc_LI, mu= 0)
t.test(LIs$Day1_finger_LI, mu= 0)
t.test(LIs$Day1.RDT_RT_LI, mu= 0)
}
```


<!---**Finger tapping and EHI** - commented out for now as focus is on planned analyses-->

```{r fingerEHI,echo=FALSE,include=TRUE }
# plot
FingersEHI <-0
if(FingersEHI==1){
finger_scatter <- ggplot(LIs, aes(x= index_EHI, y= Day1_finger_LI)) +
  geom_hline(yintercept=0, color = "black") +
  geom_vline(xintercept=0, color = "black") +
  geom_point(aes(color= handedness)) +
  geom_rug(aes(color= handedness)) +
  theme_classic() +
  ylab("Finger tapping LI (day 1)") + 
  xlab("EHI") +
  annotate("text", x = 90, y = 25, label = "paste(italic(R), \" = .58\")", parse = TRUE) +
  theme(legend.position = c(.15, .90))
# Set relative size of marginal plots (main plot 10x bigger than marginals)
ggExtra::ggMarginal(finger_scatter, groupColour = TRUE, groupFill = TRUE)
# spearman's CIs
spearman.ci(LIs$Day1_finger_LI, LIs$index_EHI, nrep = 10000, conf.level = 0.95)
# spearman's test
cor.test(LIs$Day1_finger_LI, LIs$index_EHI, method = "spearman", alternative = "greater")
# LEFT HANDERS
left <- subset(LIs, handedness== "Left")
# spearman's test
cor.test(left$Day1_finger_LI, left$index_EHI, method = "spearman", alternative = "greater")
# Right HANDERS
right <- subset(LIs, handedness== "Right")
# spearman's test
cor.test(right$Day1_finger_LI, right$index_EHI, method = "spearman", alternative = "greater")
}
```
